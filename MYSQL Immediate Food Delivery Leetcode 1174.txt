# Leetcode 1174
# Immediate Food Delivery II
# Find the percentage of immediate orders in the first orders of all customers


with CTE1 AS (
select * , 
(case when order_date = customer_pref_delivery_date then "immediate" else "scheduled" end) as order_type
from Delivery a
where order_date in (
    select min(order_date) from Delivery b
    where a.customer_id = b.customer_id)
)

select (sum(case when order_type = "immediate" then 1 else 0 end) / count(*))*100 as immediate_percentage
from CTE1